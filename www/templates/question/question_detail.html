{% extends "question/base_question.html" %}
{% load custom_tags %}
{% load custom_filters %}
{% block title %}{{question.title|str_display:20}}{% endblock %}

{% block javascript %}
{% if question.is_important %}
<script type="text/javascript">
$(document).ready(function(){
    // 精华盖章动画
    var jinghua = $('.jinghua img');
    jinghua.show()
    .css({'width': '444.5px', 'height': '385px'})
    .animate({'width': '254', 'height': '220px', 'opacity': '0.6'}, 500)
    .animate({'width': '102px', 'height': '88px', 'opacity': '0.99'}, 50);
});
</script>
{% endif %}
{% endblock %}

{% block css %}{% endblock %}

{% block question_main%}
<span class="jinghua">
    <img src="{{MEDIA_URL}}img/common/jinghua1.png"></span>

<ol class="breadcrumb">
    <li>
        <a href="/question">全部</a>
    </li>
    <li>
        <a href="{{question.question_type.get_url}}">{{question.question_type.name}}</a>
    </li>
    <li class="active">{{question.title|str_display:10}}</li>
</ol>
<div class="question-entry">
    <div class="topic pb-15 pl-15 pr-15">

        <div class="topic-title">
            <h4 class="f22"> <strong>{{question.title}}</strong>
            </h4>
        </div>
        <div class="f14 pt-10 line-height-25">{{question.content|safe}}</div>
        <div class="topic-tags row">
            <ul class="list-flow">
                {% for tag in question_tags %}{% include "question/_tags.html" %}{% endfor %}
            </ul>
        </div>
        <div class="topic-footer row">
            <div class="col-md-3">
                {% if not question.is_hide_user %}
                <!-- <a class="no-hover-unl" href="{{question.user.get_url}}">
                    <img class="avatar-25 avatar-circle" src="{{question.user.get_avatar_25}}" title="{{question.user.nick}}" />
                </a> -->
                <a href="{{question.user.get_url}}" class="zx-cardtips" data-user_id="{{question.user.id}}">
                    <span class="f12">{{question.user.nick}}</span>
                </a>
                {% endif %}
            </div>
            <div class="col-md-9 text-right">
                <span class="question-tools gray-a">
                    {% if request.user.is_staff %}
                    {% if not question.is_important %}
                    <a id="set_important_a_id" href="javascript: void(0);" 
                        onclick="set_important('{{question.id}}')">
                        设置精华
                    </a>
                    {% else %}
                    <a id="cancel_important_a_id" href="javascript: void(0);" 
                        onclick="cachel_important('{{question.id}}')">
                        取消精华
                    </a>
                    {% endif %}
                    {% endif %}
                    {% if request.user.id == question.user.id or request.user.is_staff %}
                    <a href="#" data-toggle="modal" data-target="#edit_question_modal">
                        <span class="glyphicon glyphicon-pencil"></span>
                        修改
                    </a>
                    <a href="javascript: void(0);" id="remove_question_a_id"
                        onclick="remove_question('{{question.id}}')">
                        <span class="glyphicon glyphicon-trash"></span>
                        删除
                    </a>
                    {% endif %}
                    <a class="question-share" href="javascript: void(0);">
                        <span class="glyphicon glyphicon-share-alt"></span>
                        分享
                    </a>
                    <a class="invite hide" href="javascript: void(0);">
                        <span class="glyphicon glyphicon-transfer"></span>
                        邀请回答
                    </a>
                    <!-- 分享问题菜单 -->
                    <div id="question-share-tools" class="gray-a none">
                        <a href="javascript: void(0)" class="question-share-sina">
                            <img class="w20 img-fade-hover pt-5 share-qq" title="分享到QQ微博" data-change_img="{{MEDIA_URL}}img/common/qq-active.png" src="{{MEDIA_URL}}img/common/qq.png">
                        </a>
                        <a href="javascript: void(0)" class="question-share-qq">
                            <img class="w25 img-fade-hover pt-5 share-sina" title="分享到新浪微博" data-change_img="{{MEDIA_URL}}img/common/sina-active.png" src="{{MEDIA_URL}}img/common/sina.png">
                        </a>
                        <a href="javascript: void(0)" class="question-share-wechat">
                            <img class="w25 img-fade-hover pt-5" title="分享到微信" data-change_img="{{MEDIA_URL}}img/common/wechat-active.png" src="{{MEDIA_URL}}img/common/wechat.png">
                        </a>
                    </div>

                </span>
                <span class="question-date">{{question.create_time}}</span>
            </div>
        </div>
        <div class="topic-invite panel panel-default auto-hide hide">
            <span class="arrow-out"></span>
            <span class="arrow-in"></span>
            <div class="panel-body row">
                <div class="filter-invite col-md-12">
                    <div class="col-md-4">
                        <input type="text" class="form-control input-sm" placeholder="输入你想邀请人的名字" value="">
                        <span class="glyphicon glyphicon-search search"></span>
                    </div>
                </div>
                <div class="recommend-invite col-md-12">
                    <ul class="list-flow">
                        <li class="invite-item">
                            <div class="col-md-2">
                                <img class="avatar-35 avatar-circle" src="/static/img/common/user3.jpg"></div>
                            <div class="col-md-10 invite-person-info">
                                <div class="name blue-a">
                                    <a href="javascript: void(0);" class="zx-cardtips" data-user_id="1">半夜没事瞎溜达</a>
                                    <span>
                                        <button type="button" class="btn btn-primary btn-xs pull-right">邀请回答</button>
                                    </span>
                                </div>
                                <div class="des">漫漫人生路，谁不错几步</div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        {% if request.user.id == question.user.id or request.user.is_staff %}
        <!-- 弹出层 -->
        <div class="modal fade" id="edit_question_modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form role="form" method='post' action='/question/modify_question/{{question.id}}'>
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title">修改提问</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group" >
                                <span>选择你想提问的类型:</span>
                            </div>
                            <div class="form-group" id="div_types">{% question_type_radio_display %}</div>
                            <div class="form-group" id="div_tags">
                                <div class="tag-title mb-5">将你的提问归类至子话题 :</div>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" name="question_title" placeholder="你有什么想问的？写下问题的标题" 
                                    value='{{question.title}}'></div>
                            <div class="form-group">
                                <textarea id="question_editor" name="question_content" class="form-control zx-textarea" style="height: 260px"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button type="submit" class="btn btn-primary">保存</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

<div class="replies w">
    <ul class="list-group" id="ul_replies">
        <li class="list-group-item no-l-r-bd bdc-eee">
            <h4>共 {{good_answers_count}} 个回答</h4>
        </li>
        {% for answer in good_answers %}
            {% include "question/_question_answer.html" %}
        {% endfor %}
        {% if bad_answers %}
        <li class="list-group-item no-l-r-bd bdc-eee">
            <div class="gray-a">
                <a class="collapse-answer zx-tooltip" data-toggle="tooltip" data-placement="right" data-original-title="智选希望用户通过点击「没有帮助」按钮去参与维护一个更高质量、更有价值的问答氛围，当一个回答被多次点击「没有帮助」便会被折叠。" data-trigger="hover" title="" href="javascript: void(0)">
                    共有 {{bad_answers_count}} 个回答被折叠
                    <span class="glyphicon glyphicon-question-sign" ></span>
                </a>
            </div>
        </li>
        {% for answer in bad_answers %}
            {% include "question/_question_answer.html" %}
        {% endfor %}
        {% endif %}
    </ul>

    <!-- 修改回答 -->
    <div class="modal fade" id="edit_answer_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <form role="form" method='post' action='/question/modify_answer'>
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">修改回答</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <textarea id="edit_answer_editor" name="edit_answer_content" class="form-control zx-textarea" style="height: 260px"></textarea>
                            <input type="hidden" class="edit-answer-id" name="answer_id" value=""/>
                            <input type="hidden" name="question_id" value="{{question.id}}"/>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 回复块 -->
<div class="answer">
    <h4>可以在下面添加你的回答</h4>

    <div class="answer-main">
        {% if request.user.is_authenticated %}
        <form role="form" method="post" action="/question/create_answer/{{question.id}}">
            <div class="form-group mb-0">
                <textarea id="answer_editor" name="answer_content" class="form-control zx-textarea" style="height: 100px;"></textarea>
            </div>
            <div class="form-group pull-right">
                <button type="submit" class="btn btn-primary">提交你的回答</button>
            </div>
        </form>
    {% else %}
    <div class="not-login row">
        <div class="col-md-2 lock">
            <img src="{{MEDIA_URL}}img/common/icon-locked.png"></div>
        <div class="col-md-10">
            <div class="title">须登录后才能回答</div>
            <div class="col-md-4 links">
                <a href="/login">
                    <button type="button" class="btn btn-primary btn-login">立即登录</button>
                </a>
            </div>
            <div class="col-md-4 links">
                <a href="/regist">
                    <button type="button" class="btn btn-primary btn-regist">免费注册</button>
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>
</div>
</div>
{% endblock %}