{% extends "question/base_question.html" %}
{% load custom_tags %}
{% load custom_filters %}
{% block title %}{{question.title|str_display:20}}{% endblock %}

{% block javascript %}
<script type="text/javascript">
$(document).ready(function(){
  var editor;
  KindEditor.ready(function(K) {
    editor = K.create('textarea[name=answer_content]', {
      resizeType : 1,
      width: '100%',
      height: '260',
      allowPreviewEmoticons : false,
      allowImageUpload : false,
      themesPath: "{{MEDIA_URL}}css/kindeditor/themes/",
      pluginsPath: "{{MEDIA_URL}}js/kindeditor/plugins/",
      langPath: "{{MEDIA_URL}}js/kindeditor/",
      items : [
        'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
        'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
        'insertunorderedlist', '|', 'emoticons', 'image', 'link'],
      afterCreate : function() { 
          this.sync(); 
      }, 
      afterBlur:function(){ 
          this.sync(); 
      }
    });
  });

  // 导航事件
  $('.replies .nav-tabs a').click(function (e) {
    e.preventDefault();
    $(this).tab('show');

    $('#ul_replies').hide('fast').show('fast');
  });
  
  
  // 赞动作
  var voteLoading = false;
  $('.vote button').bind('click', function(){
    if(voteLoading){
      return;
    }
    voteLoading = true;

    var btn = $(this),
        likedSpan = btn.children('span').eq(0),
        votedSpan = btn.children('span').eq(1),
        isLiked = likedSpan.hasClass('glyphicon-heart'),
        voteCount = parseInt(votedSpan.text());
        
    // 取消赞动作
    if(isLiked){
      // 动画效果
      likedSpan.css('opacity', '0.99').animate({
        opacity: 0.1,
      }, 500, function(){

        likedSpan.removeClass('glyphicon-heart').addClass('glyphicon-heart-empty').css('opacity', '0.99');
        votedSpan.text(voteCount - 1);
        voteLoading = false;
      });

    
    } else {
      // 添加赞动作
      btn.parent('.btn-group-vertical').append('<span class="glyphicon glyphicon-heart animate-liked"></span>');
      
      // 动画效果
      var animateLike = btn.siblings();
      animateLike.animate({
        opacity: 0.01,
        fontSize: 16,
        paddingLeft: 10,
        paddingTop: 6
      }, 500, function(){
        animateLike.remove();

        likedSpan.removeClass('glyphicon-heart-empty').addClass('glyphicon-heart');
        votedSpan.text(voteCount + 1);
        voteLoading = false;
      });

    }

  });

});
</script>
{% endblock %}

{% block css %}
<style type="text/css">

.zx-container-main .question-entry{
    float: left;
    /*padding-top: 25px;*/
    width: 100%;
}

.zx-container-main .question-entry .topic{
    border-radius: 4px;
    padding: 15px;
    border: solid 1px #ddd;
}

.zx-container-main .question-entry .topic-title{

}

.zx-container-main .question-entry .topic-content{
    padding-top: 25px;
    font-size: 13px;
    color: #475058;
}

.zx-container-main .question-entry .topic-footer{
    padding-top: 25px;
}

.zx-container-main .question-entry .question-date{
    float: right;
    font-size: 12px;
    color: #475058;
}

.zx-container-main .replies{
    float: left;
    width: 100%;
    padding-top: 25px;
}

.zx-container-main .reply-header{
    padding: 15px 5px 5px 5px;
}


.zx-container-main .reply-header .user-name a{
    color: #224e73;
    font-size: 12px;
}

.zx-container-main .reply-content{
    font-size: 13px;
    color: #475058;
    padding-top: 15px;
    padding-bottom: 25px;
    line-height: 25px;
}

.zx-container-main .reply-main .vote{
    padding-left: 30px;
}

.zx-container-main .reply-main .vote .btn-group-vertical{
    width: 90%;
}


.answer-title{
  border-bottom: solid 1px #e6e6e6;
}

.answer-main{
  margin-top: 15px;
  border: solid 1px #e6e6e6;
  border-radius: 5px;
}

.answer-main .editor{
  margin-bottom: 0px;
}

.answer-main button{
  margin-top: 15px;
}

.not-login{
  font-size: 12px;
}

.not-login .title{
  font-size: 12px;
  padding: 25px 0 15px 0;
}

.not-login .content{
  font-size: 12px;
  padding-bottom: 15px;
  line-height: 22px;
}

.not-login .links{
  margin-bottom: 20px;
}

.not-login .lock{
  padding: 15px 0 0 30px;
}

.vote .glyphicon{
  font-size: 16px;
}

.vote .glyphicon-heart{
  color: red;
}

.vote .animate-liked{
  position: absolute;
  top: 0px;
  left: 2px;
  z-index: 99;
  font-size: 35px;
  opacity: 0.99,
}

.breadcrumb{
  margin-top: 25px;
  border: solid 1px #ddd;
}

.replies-sort{
  margin-top: 5px;
}
</style>
{% endblock %}

{% block question_main%}
<ol class="breadcrumb">
    <li>
        <a href="/question">全部</a>
    </li>
    <li>
        <a href="{{question.question_type.get_url}}">{{question.question_type.name}}</a>
    </li>
    <li class="active">{{question.title|str_display:10}}</li>
</ol>
<div class="question-entry">
    <div class="topic">
        <div class="topic-title">
            <h4> <strong>{{question.title}}</strong>
            </h4>
        </div>
        <div class="topic-content">{{question.content|safe}}</div>
        <div class="topic-footer">
            {% if not question.is_hide_user %}
            <a href="{{question.user.get_url}}">
                <div class="avatar">
                    <img src="{{question.user.get_avatar}}" title="{{question.user.nick}}" />
                </div>
            </a>
            <a href="{{question.user.get_url}}">
                <div class="user-name">{{question.user.nick}}</div>
            </a>
            {% endif %}
            <div class="question-date">{{question.create_time}}</div>
        </div>
    </div>
    
    <div class="replies">
        <ul class="list-group" id="ul_replies">
            <li class="list-group-item">
              <div class="row">
                <div class="col-md-6">
                  <h4><strong>共4个回答</strong></h4>
                </div>
                <div class="col-md-3 pull-right">
                  <select class="form-control input-sm replies-sort">
                    <option>按赞最多排序</option>
                    <option>按时间排序</option>
                  </select>
                </div>
              </div>
            </li>
            <li class="list-group-item">
                <div class="reply-header">
                    <a href="#">
                        <div class="avatar">
                            <img src="{{MEDIA_URL}}img/common/default.png" />
                        </div>
                    </a>
                    <a href="#">
                        <div class="user-name">stranger</div>
                    </a>
                    <div class="question-date">2013.12.13 12:27:49</div>
                </div>
                <div class="reply-main row">
                    <div class="reply-content col-md-9">陆金所的收益率更低，24－36个月期限的每年收益率还不到9%，而且还是“预期”，不是约定收益率。</div>
                    <div class="vote col-md-3">
                        <div class="btn-group-vertical">
                            <button type="button" class="btn btn-default">
                                <span class="glyphicon glyphicon-heart pull-left"></span>
                                <span class="badge">122</span>
                            </button>
                        </div>
                    </div>
                </div>
            </li>
            <li class="list-group-item">
                <div class="reply-header">
                    <a href="#">
                        <div class="avatar">
                            <img src="{{MEDIA_URL}}img/common/default.png" />
                        </div>
                    </a>
                    <a href="#">
                        <div class="user-name">半夜没事瞎溜达</div>
                    </a>
                    <div class="question-date">2013.12.13 12:27:49</div>
                </div>
                <div class="reply-main row">
                    <div class="reply-content col-md-9">
                        yangjinzhong9，你好！平台上发布的每个项目都是由与我们合作的担保机构提供本金和利息担保的，这样就将投资人的风险转移给了担保公司，对于投资人可以说是没有风险的哦！对于要投资多少份额你要根据资金情况及个人规划来决定哦！:) 感谢你的持续关注与支持！上有利，好收益！
                    </div>
                    <div class="vote col-md-3">
                        <div class="btn-group-vertical">
                            <button type="button" class="btn btn-default">
                                <span class="glyphicon glyphicon-heart-empty pull-left"></span>
                                <span class="badge">42</span>
                            </button>
                        </div>
                    </div>
                </div>
            </li>
            <li class="list-group-item">
                <div class="reply-header">
                    <a href="#">
                        <div class="avatar">
                            <img src="{{MEDIA_URL}}img/common/default.png" />
                        </div>
                    </a>
                    <a href="#">
                        <div class="user-name">有利网小利</div>
                    </a>
                    <div class="question-date">2013.12.15 15:23:12</div>
                </div>
                <div class="reply-main row">
                    <div class="reply-content col-md-9">各有优缺点。有利在安全上还是比较靠谱，只是利率低一点。陆金所还可以，毕竟是平安集团旗下的，但开鑫贷我不看好。</div>
                    <div class="vote col-md-3">
                        <div class="btn-group-vertical">
                            <button type="button" class="btn btn-default">
                                <span class="glyphicon glyphicon-heart-empty pull-left"></span>
                                <span class="badge">12</span>
                            </button>
                        </div>
                    </div>
                </div>
            </li>
            <li class="list-group-item">
                <div class="reply-header">
                    <a href="#">
                        <div class="avatar">
                            <img src="{{MEDIA_URL}}img/common/default.png" />
                        </div>
                    </a>
                    <a href="#">
                        <div class="user-name">有利网小利</div>
                    </a>
                    <div class="question-date">2013.12.15 15:23:12</div>
                </div>
                <div class="reply-main row">
                    <div class="reply-content col-md-9">各有优缺点。有利在安全上还是比较靠谱，只是利率低一点。陆金所还可以，毕竟是平安集团旗下的，但开鑫贷我不看好。</div>
                    <div class="vote col-md-3">
                        <div class="btn-group-vertical">
                            <button type="button" class="btn btn-default">
                                <span class="glyphicon glyphicon-heart-empty pull-left"></span>
                                <span class="badge">12</span>
                            </button>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <!-- 回复块 -->
    <div class="answer">
        <div class="answer-title">
            <h3>你可以在下面添加你的回答</h3>
        </div>

        <div class="answer-main">
            {% if request.user.is_authenticated %}
            <form role="form">
                <div class="form-group editor">
                    <textarea name="answer_content" class="form-control" rows="6"></textarea>
                </div>
                <div class="form-group pull-right">
                    <button type="submit" class="btn btn-primary">提交你的回答</button>
                </div>
            </form>
            {% else %}
            <div class="not-login row">
                <div class="col-md-2 lock">
                    <img src="{{MEDIA_URL}}img/common/icon-locked.png"></div>
                <div class="col-md-10">
                    <div class="title">回复前请登录</div>
                    <div class="content">须登录后才能发表你的回复，点击下面的登录按钮进行登录，如果你还没有成为我们的会员，请点击下面的注册按钮进行新用户注册</div>
                    <div class="col-md-6 links">
                        <a href="/login">
                            <button type="button" class="btn btn-primary btn-lg">立即登录</button>
                        </a>
                    </div>
                    <div class="col-md-6 links">
                        <a href="/regist">
                            <button type="button" class="btn btn-primary btn-lg">免费注册</button>
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}